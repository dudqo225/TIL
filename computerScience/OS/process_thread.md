# CS | Process Vs. Thread

<br>

프로세스(Process)와 쓰레드(Thread)의 차이에 대해서 알아보자.

<br>

***

#### 목차

> 1. 프로세스란?
> 2. 쓰레드란?
> 3. 멀티 프로세스 & 멀티 쓰레드
> 6. 참고자료

<br>

***

<br>

#### 프로그램이란?

- 실행 가능한 명령어의 집합
- 형태
  - 디스크에 저장되어 컴파일된 바이너리 이미지, 파이썬 스크립트와 같은 Interpret 고급어 등

<br>

### 1. 프로세스란?

![img](images/images%2Fgparkkii%2Fpost%2F3ad2bcba-e652-4213-a10c-78b5a13c95b0%2FKakaoTalk_Photo_2021-01-02-18-02-01.jpeg)

- **컴퓨터의 메모리에 적재(load)되어 연속적으로 실행되고 있는 프로그램**
- 메모리에 올라와 실행되고 있는 프로그램의 **인스턴스(독립적인 개체임)**
- OS로부터 시스템 자원을 할당받는 작업의 단위
  - 시스템 자원
    - CPU 시간
    - 주소 공간
    - Code, Data, Stack, Heap 구조의 독립된 메모리 영역
- 기본적으로 프로세스당 최소 1개의 쓰레드(메인 쓰레드)를 가지고 있음

<br>

#### 프로세스 구조

- 프로세스는 각각 독립된 메모리 영역을 할당 받는다
  - **Code** - 프로그램의 실제 코드 저장
  - **Data** - 프로세스가 실행될 때 정의된 전역 변수, static 변수 저장
  - **Stack** - 함수에서 다른 함수를 실행하는 등, 서브루틴 정보를 저장
  - **Heap** - 프로세스 런타임 중 동적으로 할당되는 변수 저장

<br>

#### 특징

- 각 프로세스는 별도의 주소 공간에서 실행됨
- 따라서, 한 프로세스에서 다른 프로세스의 변수, 자료구조에 접근할 수 X
  - 접근하려면 프로세스 간 통신(IPC, Inter-Process Communication) 사용해야 함(파이프, 파일, 소켓 등의 방법)

<br>

***

### 2. 쓰레드란?

![img](images/images%2Fgparkkii%2Fpost%2F5b17f0cb-d2c7-4995-b2dd-f86f58968d2f%2FKakaoTalk_Photo_2021-01-02-18-29-56.jpeg)

- **프로세스 내에서 실행되는 흐름**
- 프로세스가 할당받은 자원을 이용하는 실행 단위

<br>

#### 쓰레드 구조

- 하나의 프로세스 안에서 각각의 Stack만 따로 할당받음
- 나머지 Code, Data, Heap 영역은 공유함

<br>

#### 특징

- 한 프로세스 내에서 동작되는 여러 실행의 흐름이므로, 프로세스 내의 주소 공간, 자원을 공유함
  - 같은 프로세스 안에 있는 여러 쓰레드는 같은 힙 공간을 공유함
- 각각의 쓰레드는 별도의 레지스터, 스택을 갖고 있음
- 하나의 쓰레드에서 프로세스 자원을 변경하면, 이웃 쓰레드(Sibling Thread)도 변경 결과가 반영됨

<br>

#### Java Thread

- 일반 OS Thread와 거의 차이가 없음
- JVM(Java Virtual Machine)이 OS 역할을 함
- 자바에는 프로세스가 존재하지 않고 쓰레드만 존재함
  - Java Thread - JVM에 의해 스케쥴링되는 실행 단위 코드 블록
- JVM이 쓰레드 관련 정보를 관리함
  - 쓰레드가 몇 개 존재하는지
  - 프로그램 코드의 메모리 위치가 어디인지
  - 쓰레드의 상태가 무엇인지
  - 쓰레드 우선순위는 어떠한지
  - ...

<br>

#### Process Vs. Thread

| 차이           | Process                                                      | Thread                                                       |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 자원 할당      | 실행할 때마다 새로운 자원 할당                               | 자신을 실행한 프로세스의 자원을 공유                         |
| 자원 공유      | 일반적으로 자원 공유 X<br />같은 프로그램의 프로세스일 경우 Code 공유 | 같은 프로세스 내 쓰레드들은 Stack을 제외한 3개 영역을 공유함 |
| 독립성         | 독립적                                                       | 프로세스의 하위 집합                                         |
| 주소 소유      | 별개의 주소 공간을 가짐                                      | 주소 공간을 공유함                                           |
| 통신           | 시스템이 제공하는 IPC 방법으로 통신                          | 공유 변수 수정 등 자유롭게 다른 쓰레드와 통신                |
| Context Switch | 일반적으로 쓰레드보다 느림                                   | 상황에 따라 그렇지 않을 수 있음                              |

<br>

***

### 3. 멀티 프로세스 & 멀티 쓰레드

#### 멀티 프로세스 (Multi Process)

- 멀티 프로세싱이란?
  - **하나의 응용 프로그램을 여러 개의 프로세스로 구성**하여 각 프로세스가 하나의 작업을 처리하도록 하는 것
  - 참고
    - 멀티 태스킹 (Multi Tasking) - 같은 시간에 여러 개의 프로그램을 띄우는 것
- 장/단점
  - 장점
    - 여러개의 자식 프로세스 중 하나에 문제가 발생할 경우. 해당 프로세스만 Kill하면 됨. 다른 영향 없음
  - 단점
    - Context Switching 할 때의 오버헤드
      - 캐시 메모리 초기화와 같은 무거운 작업이 진행되고, 많이 시간이 소모됨
      - 프로세스는 각각 독립된 메모리 영역을 할당받음. 프로세스 간 공유하는 메모리가 X
        - Context Switching이 발생하면 캐시에 있는 모든 데이터를 리셋하고 다시 캐시 정보를 불러와야 한다..
    - IPC가 어렵고 복잡함
      - 독립된 메모리 영역 할당으로 인해, 포르세스 간 변수를 공유할 수 없음

<br>

##### Context Switching 이란?

- CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는 과정
- 동작 중인 프로세스가 대기하면서 해당 프로세스의 상태(Context)를 PCB(Process Control Block)에 보관 → 대기 중인 다음 순서의 프로세스가 동작하면서 이전에 보관했던 프로세스의 상태를 복구한다

![img](images/0JIdPnyekpiI7e_dG.png)

<br>

#### 멀티 쓰레드 (Multi Thread)

- 멀티 쓰레딩이란?
  - **하나의 응용 프로그램의 여러 개의 쓰레드로 구성**하여 각 쓰레드가 하나의 작업을 처리하도록 하는 것
  - Window, Linux 등 많은 OS는 멀티 쓰레딩을 기본으로 함
    - 멀티 프로세싱도 지원
  - 대표적인 멀티 쓰레드 응용프로그램
    - **웹 서버(Web Server)**
- 장/단점
  - 장점
    - 자원 효율성 증대 (시스템 자원 소모 감소)
      - 시스템 콜(프로세스를 생성하여 자원을 할당하는 것)이 줄어들어 자원의 효율적 관리 가능
    - 처리 비용 감소 (시스템 처리량 증가)
      - 쓰레드 간 데이터 통신이 간단해서 시스템의 자원 소모가 줄어듬
      - 쓰레드 사이의 작업량이 작아 Context Switching이 빠름
    - 간단한 통신 방법 (프로그램 응답 시간 단축)
      - 프로세스 내의 Stack을 제외한 모든 메모리 영역을 공유하기 때문에 통신 부담이 적다
  - 단점
    - 주의 깊은 설계 필요
    - 디버깅의 어려움
    - 시스템이 단일 프로세스일 경우 큰 효과 X
    - 다른 프로세스에서 쓰레드를 제어할 수 X
    - 자원 공유 문제가 발생할 수 있음 (동기화 문제)
    - 하나의 쓰레드에 문제 발생시 전체 프로세스가 영향을 받음

<br>

![img](images/images%2Fgparkkii%2Fpost%2Fbc9b51ee-734b-403b-a036-c6bd84abbc58%2FKakaoTalk_Photo_2021-01-02-18-53-31.jpeg)

#### 멀티 프로세스 대신 멀티 쓰레드 사용하는 이유

- 멀티 프로세스는 프로그램을 여러 개 실행하는 것 vs. 멀티 쓰레드는 하나의 프로그램 안에서 여러 작업을 해결하는 것
- 이유
  - 자원 효율성 증대
    - 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있음
    - 프로세스 간의 Context Switching시 단순히 CPU 레지스터 교체 뿐 아니라 RAM과 CPU 사이의 캐시 메모리에 대한 데이터까지 초기화되므로 오버헤드가 크기 때문
    - 쓰레드는 프로세스 내의 메모리를 공유하기 때문에 독립적인 프로세스와 달리 쓰레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 줄어들게 된다.
  - 처리 비용 감소 & 응답 시간 단축
    - 프로세스 간 통신(IPC)보다 쓰레드 간 통신 비용이 적음 → 작업 간 통신 부담이 줄어듬
    - 프로세스 간 전환 속도보다 쓰레드 간 전환 속도가 빠름
      - Context Switching 시 쓰레드는 Stack 영역만 처리하기 때문

- 문제점
  - 동기화 문제 발생 가능
    - 쓰레드 간 자원 공유는 전역 변수를 이용함
    - 함께 사용하면서 충돌 발생할 가능성 O

<br>

##### Thread Safe란?

- 여러개의 Thread가 동시에 사용되어도 안전하다는 것을 의미함
- 특정 함수/변수가 여러 쓰레드에서 호출되어도 하나의 쓰레드에서 호출했을 때와 같은 결과가 보장되어야 함
  - 함수가 전역 변수를 참조할 경우, Thread Safe 하지 않을 수 있음
- 예상 질문
  - Thread Safe 하지 않은 조건을 만드는 방법의 예
  - Thread Safe 하지 않은 환경을 Thread Safe 하게 변경하는 방법

<br>

***

### 4. 참고자료

- https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html
- https://shoark7.github.io/programming/knowledge/difference-between-process-and-thread
- https://brunch.co.kr/@babosamo/100
- https://charlezz.medium.com/process%EC%99%80-thread-%EC%9D%B4%EC%95%BC%EA%B8%B0-5b96d0d43e37
- https://velog.io/@gparkkii/ProgramProcessThread
